(function(){"use strict";function e(e){var t=new Map;return(e||[]).forEach(function(e){e&&e.name&&(t.has(e.name)||t.set(e.name,e))}),Array.from(t.values())}function t(e){return/^[a-f0-9]{32}$/i.test(e||"")}function n(e){var t=(e||"").toLowerCase();return!t||("jbcookies"!==t&&0===t.indexOf("jbcookies")||(0===t.indexOf("atum")||0===t.indexOf("oscolorscheme")))}function a(e){if(!e||!e.name)return e;var t=e.name.toLowerCase();return"_ga"!==t&&0!==t.indexOf("_ga_")||(e.category="analytics",e.provider=e.provider||"Google Analytics"),0===t.indexOf("joomla_remember_me")&&(e.category="necessary",e.provider=e.provider||"Joomla!",e.description=e.description||"Mantiene la sesión recordada para el usuario autenticado."),"joomla_user_state"===t&&(e.category="necessary",e.provider=e.provider||"Joomla!",e.description=e.description||"Conserva el estado de autenticación del usuario."),e}function r(e){var t=(e||"").trim();if(!t)return"";var n=t.toLowerCase();return 0===n.indexOf("joomla_remember_me_")?"joomla_remember_me_*":0===n.indexOf("_ga_")?"_ga_*":t}function o(e,t){return e?e.split(";").map(function(e){var n=e.split("=")[0].trim();return n?{name:n,source:t||window.location.hostname,category:"unassigned"}:null}).filter(function(e){return null!==e}):[]}function i(e,t){return new Promise(function(n){try{if(!e)return void n([]);var a=document.createElement("iframe");a.style.width="0",a.style.height="0",a.style.border="0",a.style.position="absolute",a.style.left="-9999px",a.style.top="-9999px",a.setAttribute("aria-hidden","true");var r=e+(t||"");-1===r.indexOf("?")?r+="?":r+="&",r+="jbcookies_inventory_probe=1&_="+String(Date.now()),a.onload=function(){setTimeout(function(){try{var e=a.contentDocument||a.contentWindow&&a.contentWindow.document,t=e?e.cookie:"",r="";try{r=a.contentWindow&&a.contentWindow.location&&a.contentWindow.location.hostname?a.contentWindow.location.hostname:""}catch(e){r=""}n(o(t,r||window.location.hostname))}catch(e){n([])}finally{try{a.remove()}catch(e){}}},1500)},a.src=r,document.body.appendChild(a)}catch(e){n([])}})}function s(e){if(!e)return{success:!1,message:"Empty response",data:[]};if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return{success:!1,message:"Invalid JSON response",data:[]}}return"object"!=typeof e?{success:!1,message:"Unexpected response type",data:[]}:Object.prototype.hasOwnProperty.call(e,"success")?{success:!!e.success,message:e.message||"",data:Array.isArray(e.data)?e.data:e.data?[e.data]:[]}:{success:!0,message:"",data:Array.isArray(e)?e:[e]}}function c(){var e=['input[name^="jform[params][cookie_prefs]"]','select[name^="jform[params][cookie_prefs]"]','textarea[name^="jform[params][cookie_prefs]"]'].join(","),t=document.querySelector(e);if(t&&t.closest){var n=t.closest("joomla-field-subform");if(n)return n}return document.querySelector('joomla-field-subform[name*="[cookie_prefs]"]')}function u(e){return e&&"function"==typeof e.getRows?e.getRows():[]}function d(e,t){for(var n=u(e),a=0;a<n.length;a++){var r=n[a],o=r.querySelector('select[name$="[category]"]');if(o&&o.value===t)return r}if("function"!=typeof e.addRow)return null;var i=e.addRow();if(!i)return null;var s=i.querySelector('select[name$="[category]"]');return s&&(s.value=t,s.dispatchEvent(new Event("change",{bubbles:!0}))),i}function l(e){for(var t=e.querySelectorAll("joomla-field-subform"),n=0;n<t.length;n++){var a=t[n].getAttribute("name")||"";if(-1!==a.indexOf("[preferences]"))return t[n]}return null}function f(e){var t=["necessary","analytics","marketing","unassigned"];t.forEach(function(t){d(e,t)})}function m(e){for(var t=new Set,n=e.querySelectorAll('input[name$="[name]"]'),a=0;a<n.length;a++){var o=(n[a].value||"").trim();if(o){t.add(o);var i=r(o);i&&t.add(i)}}return t}function v(e){var t=new Set;if(!e)return t;for(var n=e.querySelectorAll('input[name$="[name]"]'),a=0;a<n.length;a++){var o=(n[a].value||"").trim();if(o){t.add(o);var i=r(o);i&&t.add(i)}}return t}function p(e,t){var n=e.querySelector('input[type="radio"][name$="['+t+']"][value="1"]');n&&(n.checked=!0,n.dispatchEvent(new Event("change",{bubbles:!0})))}function y(e){var t=c();if(!t)throw new Error("No se ha encontrado el subform cookie_prefs");f(t);var n=v(t),a={necessary:[],analytics:[],marketing:[],unassigned:[]};(e||[]).forEach(function(e){if(e&&e.name){var t=(e.category||"unassigned").toLowerCase();a[t]||(t="unassigned"),a[t].push(e)}}),Object.keys(a).forEach(function(e){var o=d(t,e);if(o){var i=m(o),s=l(o);s&&"function"==typeof s.addRow&&a[e].length&&a[e].forEach(function(e){var t=r(e.name);if(t&&!i.has(t)&&!n.has(t)){var a=s.addRow();if(a){var o=a.querySelector('input[name$="[name]"]');o&&(o.value=t,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0})));var c=a.querySelector('input[name$="[provider]"]');c&&!c.value&&(c.value=(e.provider||"").trim(),c.dispatchEvent(new Event("input",{bubbles:!0})),c.dispatchEvent(new Event("change",{bubbles:!0})));var u=a.querySelector('input[name$="[description]"]');u&&!u.value&&(u.value=(e.description||"").trim(),u.dispatchEvent(new Event("input",{bubbles:!0})),u.dispatchEvent(new Event("change",{bubbles:!0}))),p(a,"show"),i.add(t),n.add(t)}}})}}),t.dispatchEvent(new CustomEvent("joomla:updated",{bubbles:!0}))}async function h(r,o){if(!r)throw new Error("URL de detección no disponible");o&&(o.disabled=!0);try{var c=o&&o.getAttribute("data-site-root")||"",u=await fetch(r,{method:"GET",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),d=await u.text(),l=s(d);if(!l.success)throw new Error(l.message||"Error detectando cookies");var f=l.data||[],m=r;-1!==m.indexOf("mode=scan")?m=m.replace("mode=scan","mode=detect"):m+=(-1===m.indexOf("?")?"?":"&")+"mode=detect";var v=[];try{var p=await fetch(m,{method:"GET",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}}),h=await p.text(),g=s(h);g.success&&(v=g.data||[])}catch(e){}var w=o&&o.getAttribute("data-lang-prefix")||"",b=await i(c,w),E=e([].concat(f,v,b));E=E.map(function(e){return a(e)}).filter(function(e){return!(!e||!e.name)&&(!n(e.name)&&!t(e.name))}),y(E)}finally{o&&(o.disabled=!1)}}window.JBCookiesInventory=window.JBCookiesInventory||{},window.JBCookiesInventory.detectAndFill=h,document.addEventListener("click",function(e){var t=e.target.closest("[data-jbcookies-inventory-button]");if(t){e.preventDefault();var n=t.getAttribute("data-url")||"";h(n,t).catch(function(e){try{if(window.Joomla&&Joomla.renderMessages)return void Joomla.renderMessages({error:[e&&e.message?e.message:String(e)]})}catch(e){}alert(e&&e.message?e.message:String(e))})}})})();